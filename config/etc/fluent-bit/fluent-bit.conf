[SERVICE]
    Flush           5
    Daemon          Off
    Log_Level       info
    Parsers_File    parsers.conf
    # Persist file tracking offsets across restarts
    storage.path    /var/lib/fluent-bit/

# ============================================================
# Input: read all systemd journal entries
# ============================================================
[INPUT]
    Name            systemd
    Tag             edge.*
    Read_From_Tail  On
    Strip_Underscores On
    Lowercase       On
    DB              /var/lib/fluent-bit/systemd.db

# ============================================================
# Filter: add device metadata
# ============================================================
[FILTER]
    Name            modify
    Match           edge.*
    # Set a static source field so server-side fluentd
    # recognises these as edge device logs
    Add             source edge

# Use Lua to map numeric priority to severity label
[FILTER]
    Name            lua
    Match           edge.*
    script          /etc/fluent-bit/severity.lua
    call            add_severity

# ============================================================
# Output: forward to central Fluentd collector
# ============================================================
[OUTPUT]
    Name            forward
    Match           edge.*
    Host            sentry.meticulousespresso.com
    Port            24225
    Tag             edge
    # TLS for transport encryption
    tls             On
    tls.verify      On
    # Retry forever - edge devices may be offline
    Retry_Limit     False
    # Shared secret must match server-side Fluentd config
    Shared_Key      meticulous-edge-logs
